<!DOCTYPE html>





<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  
    
    Урок 1
  
 | Пишем ботов для Telegram на языке Python</title>



<link rel="stylesheet" href="/test-web/css/override.css">
<link rel="stylesheet" href="/test-web/book.min.b7d5ee4f671b06dde5fd61ab409a54048ba7759e99fed39ac32a7be45d4d92cd.css">



<link rel="icon" href="/test-web/favicon.png" type="image/x-icon">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href="http://localhost:1313/test-web/">Пишем ботов для Telegram на языке Python</a>
</h2>



    
  
  
  

  <style>
  nav ul a[href$="\2ftest-web\2f docs\2flesson_01\2f "] {
      color: #004ed0;
  }
  </style>

<ul>
<li><a href="/test-web/"><strong>Введение</strong></a></li>
<li><a href="/test-web/docs/lesson_01/">Урок 1. Введение, простой echo-бот</a></li>
<li><a href="/test-web/docs/lesson_02/">Урок 2</a></li>
<li><strong>Дополнительные материалы</strong></li>
</ul>





</nav>



    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/test-web/svg/menu.svg" alt="Menu" />
  </label>
  <strong>
  
    
    Урок 1
  
</strong>
</header>

      
<article class="markdown">

<h1 id="урок-1-введение-простой-echo-бот">Урок 1. Введение, простой echo-бот</h1>

<h2 id="введение">Введение</h2>

<p>Приветствую тебя, читатель! Telegram Bot API – это мощный инструмент для вообще чего угодно. Автоматизация действий, работа с пользователями, онлайн-магазины, игры и много чего ещё. В этом учебнике мы научимся писать ботов для Telegram на языке Python.</p>

<p>Сразу оговорюсь: тот бот, который получится в итоге - это лишь прототип, цель всех этих постов - рассказать об основах ботостроения, показать, как можно за короткое время написать простого бота для своих нужд.</p>

<p>Язык программирования будет Python 3, но это не означает, что любители PHP, Ruby и т.д. в пролёте; все основные принципы совпадают. Я не буду особо останавливаться на описании самого языка, желающие могут ознакомиться с документацией по Python <a href="https://www.python.org/doc/versions/">здесь</a>.</p>

<p>⚠️ TODO - ссылки внутри!!!
<div class="book-expand">
  <label>
    <div class="book-expand-head flex justify-between">
      <span>⚠️ Важно!</span>
      <span>↕</span>
    </div>
    <input type="checkbox" style="display: none" />
    <div class="book-expand-content markdown-inner">
      Со временем мне, как автору, стало понятно, что материал из первой версии этого урока сильно устарел и вызывает больше вопросов, чем ответов. Так что, отныне в этом уроке сразу используются хэндлеры (декораторы). Что это и зачем, можно прочитать в соответствующем доп. материале
    </div>
  </label>
</div>
</p>

<h2 id="подготовка-к-запуску">Подготовка к запуску</h2>

<p>Взаимодействие ботов с людьми основано на HTTP-запросах. С первых дней появления API ботов, я использую библиотеку <a href="https://github.com/eternnoir/pyTelegramBotAPI">pyTelegramBotAPI</a>, которая берет на себя все нюансы отправки и получения запросов, позволяя сконцентрироваться непосредственно на логике. Установка библиотеки предельно простая:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-none" data-lang="none"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-none" data-lang="none">pip install pytelegrambotapi
python3</code></pre></td></tr></table>
</div>
</div>

<p><center>
<figure style="padding: 0.25rem; margin: 1rem 0">
    <img style="max-width: 100%; height: auto;" src="/test-web/images/l1_1.jpg" alt="Скриншот из терминала с запущенным интерпретатором Python"/>
    <figcaption>
         <h4><i>Скриншот из терминала с запущенным интерпретатором Python</i></h4>
    </figcaption>
</figure>
</center></p>

<p>Теперь можно выйти из режима Python-консоли (Ctrl+Z или Ctrl+D, или <code>exit()</code>)</p>

<h2 id="пишем-простого-echo-бота">Пишем простого echo-бота</h2>

<p>Ну, довольно слов, перейдем к делу. В качестве практики к первому уроку, напишем бота, повторяющему присланное текстовое сообщение. Создадим каталог, а внутри него создадим 2 файла: <code>bot.py</code> и <code>config.py</code>. Я рекомендую выносить различные константы и настройки в файл <code>config.py</code>, дабы не загромождать другие. В файл <code>config.py</code> впишем:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-none" data-lang="none"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-none" data-lang="none"># -*- coding: utf-8 -*-
token = &#39;1234567890:AAE_abCDEFghijKLmNOpqRsTuVWxyz&#39;</code></pre></td></tr></table>
</div>
</div>

<p>⚠️ TODO - ссылка!
Теперь надо научить бота реагировать на сообщения. Напишем обработчик, который будет реагировать на все текстовые сообщения. (напоминаю: чтобы понять хэндлеры, прочтите этот доп.материал)</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-none" data-lang="none"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-none" data-lang="none">@bot.message_handler(content_types=[&#34;text&#34;])
def repeat_all_messages(message): # Название функции не играет никакой роли, в принципе
    bot.send_message(message.chat.id, message.text)</code></pre></td></tr></table>
</div>
</div>

<p>Теперь запустим бесконечный цикл получения новых записей со стороны Telegram:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-none" data-lang="none"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-none" data-lang="none">if __name__ == &#39;__main__&#39;:
    bot.polling(none_stop=True)</code></pre></td></tr></table>
</div>
</div>

<p>Функция polling запускает т.н. <a href="http://www.pubnub.com/blog/http-long-polling/">Long Polling</a>, а параметр <code>none_stop=True</code> говорит, что бот должен стараться не прекращать работу при возникновении каких-либо ошибок. При этом, само собой, за ботом нужно следить, ибо сервера Telegram периодически перестают отвечать на запросы или делают это с большой задержкой приводя к <a href="https://ru.wikipedia.org/wiki/Список_кодов_состояния_HTTP#5xx">ошибкам 5xx</a>)</p>

<p>Итак, полный код файла <code>bot.py</code> выглядит следующим образом:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-none" data-lang="none"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-none" data-lang="none"># -*- coding: utf-8 -*-
import config
import telebot

bot = telebot.TeleBot(config.token)

@bot.message_handler(content_types=[&#34;text&#34;])
def repeat_all_messages(message): # Название функции не играет никакой роли, в принципе
    bot.send_message(message.chat.id, message.text)

if __name__ == &#39;__main__&#39;:
     bot.polling(none_stop=True)</code></pre></td></tr></table>
</div>
</div>

<p>Готово! Осталось запустить бота: <code>python3 bot.py</code></p>

<p><center>
<figure style="padding: 0.25rem; margin: 1rem 0">
    <img style="max-width: 100%; height: auto;" src="/test-web/images/l1_2.jpg" alt="Бот работает"/>
    <figcaption>
         <h4><i>Бот работает</i></h4>
    </figcaption>
</figure>
</center></p>

<p>На этом первый урок окончен.</p>
</article>

      

      
    </div>

    
  

  <aside class="book-toc level-3 fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#урок-1-введение-простой-echo-бот">Урок 1. Введение, простой echo-бот</a>
<ul>
<li><a href="#введение">Введение</a></li>
<li><a href="#подготовка-к-запуску">Подготовка к запуску</a></li>
<li><a href="#пишем-простого-echo-бота">Пишем простого echo-бота</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>
  
  
  
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>

</html>
